define("circuits/declare",[],function(){function a(e,t){throw new Error("declare"+(t?" "+t:"")+": "+e)}function f(e,t){var r=[],s=[{cls:0,refs:[]}],o={},u=1,f=e.length,l=0,c,h,p,d,v,m,g,y;for(l=0;l<f;l+=1){p=e[l],p?n.call(p)!=="[object Function]"&&a("mixin #"+l+" is not a callable constructor.",t):a("mixin #"+l+" is unknown. Did you use dojo.require to pull it in?",t),h=p._meta?p._meta.bases:[p],d=0;for(c=h.length-1;c>=0;c-=1)v=h[c].prototype,v.hasOwnProperty("declaredClass")||(v.declaredClass="uniqName_"+(i+=1)),g=v.declaredClass,o.hasOwnProperty(g)||(o[g]={count:0,refs:[],cls:h[c]},u+=1),m=o[g],d&&d!==m&&(m.refs.push(d),d.count+=1),d=m;d.count+=1,s[0].refs.push(d)}while(s.length){d=s.pop(),r.push(d.cls),u-=1;while((y=d.refs).length===1){d=y[0];if(!d||(d.count-=1)){d=0;break}r.push(d.cls),u-=1}if(d)for(l=0,f=y.length;l<f;l+=1)d=y[l],(d.count-=1)||s.push(d)}return u&&a("can't build consistent linearization",t),p=e[0],r[0]=p?p._meta&&p===r[r.length-p._meta.bases.length]?p._meta.bases.length:1:0,r}function c(e,n,r){var i,o,u,f,l,c,h,p,d,v=this._inherited=this._inherited||{};typeof e=="string"&&(i=e,e=n,n=r),r=0,f=e.callee,i=i||f.nom,i||a("can't deduce a name to call inherited()",this.declaredClass),l=this.constructor._meta,u=l.bases,d=v.p;if(i!==s){if(v.c!==f){d=0,c=u[0],l=c._meta;if(l.hidden[i]!==f){o=l.chains,o&&typeof o[i]=="string"&&a("calling chained method with inherited: "+i,this.declaredClass);do{l=c._meta,h=c.prototype;if(l&&(h[i]===f&&h.hasOwnProperty(i)||l.hidden[i]===f))break}while(c=u[d+=1]);d=c?d:-1}}c=u[d+=1];if(c){h=c.prototype;if(c._meta&&h.hasOwnProperty(i))r=h[i];else{p=t[i];do{h=c.prototype,r=h[i];if(r&&(c._meta?h.hasOwnProperty(i):r!==p))break}while(c=u[d+=1])}}r=c&&r||t[i]}else{if(v.c!==f){d=0,l=u[0]._meta;if(l&&l.ctor!==f){o=l.chains,(!o||o.constructor!=="manual")&&a("calling chained constructor with inherited",this.declaredClass);while(c=u[d+=1]){l=c._meta;if(l&&l.ctor===f)break}d=c?d:-1}}while(c=u[d+=1]){l=c._meta,r=l?l.ctor:c;if(r)break}r=c&&r}v.c=r,v.p=d;if(r)return n===!0?r:r.apply(this,n||e)}function h(e,t){return typeof e=="string"?this.__inherited(e,t,!0):this.__inherited(e,!0)}function p(e,t,n){var r=this.getInherited(e,t);if(r)return r.apply(this,n||t||e)}function v(e){var t,n=this.constructor._meta.bases;for(t=0,l=n.length;t<l;t+=1)if(n[t]===e)return!0;return this instanceof e}function m(e,t){var n;for(n in t)n!==s&&t.hasOwnProperty(n)&&(e[n]=t[n])}function g(e,r){var i,o;for(i in r)o=r[i],(o!==t[i]||!(i in t))&&i!==s&&(n.call(o)==="[object Function]"&&(o.nom=i),e[i]=o);return e}function y(e){return N.safeMixin(this.prototype,e),this}function b(e,t){return function(){var n=arguments,r=n,i=n[0],s,o,u,a=e.length,f;if(!(this instanceof n.callee))return T(n);if(t&&(i&&i.preamble||this.preamble)){f=new Array(e.length),f[0]=n;for(o=0;;){i=n[0],i&&(s=i.preamble,s&&(n=s.apply(this,n)||n)),s=e[o].prototype,s=s.hasOwnProperty("preamble")&&s.preamble,s&&(n=s.apply(this,n)||n);if((o+=1)===a)break;f[o]=n}}for(o=a-1;o>=0;o-=1)s=e[o],u=s._meta,s=u?u.ctor:s,s&&s.apply(this,f?f[o]:n);s=this.postscript,s&&s.apply(this,r)}}function w(e,t){return function(){var n=arguments,r=n,i=n[0],s;if(!(this instanceof n.callee))return T(n);t&&(i&&(s=i.preamble,s&&(r=s.apply(this,r)||r)),s=this.preamble,s&&s.apply(this,r)),e&&e.apply(this,n),s=this.postscript,s&&s.apply(this,n)}}function E(e){return function(){var t=arguments,n=0,r,i;if(!(this instanceof t.callee))return T(t);for(;r=e[n];n+=1){i=r._meta,r=i?i.ctor:r;if(r){r.apply(this,t);break}}r=this.postscript,r&&r.apply(this,t)}}function S(e,t,n){return function(){var r,i,s,o=0,u=1;n&&(o=t.length-1,u=-1);for(;r=t[o];o+=u)i=r._meta,s=(i?i.hidden:r.prototype)[e],s&&s.apply(this,arguments)}}function x(e){r.prototype=e.prototype;var t=new r;return r.prototype=null,t}function T(e){var t=e.callee,n=x(t);return t.apply(n,e),n}function N(r,i,l){typeof r!="string"&&(l=i,i=r,r=""),l=l||{};var p,g,T,C,k,L,A,O=1,M=i;n.call(i)==="[object Array]"?(L=f(i,r),T=L[0],O=L.length-T,i=L[O]):(L=[0],i?n.call(i)==="[object Function]"?(T=i._meta,L=L.concat(T?T.bases:i)):a("base class is not a callable constructor.",r):i!==null&&a("unknown base class. Did you use dojo.require to pull it in?",r));if(i)for(g=O-1;;g-=1){p=x(i);if(!g)break;T=L[g],(T._meta?m:e)(p,T.prototype),C=new Function,C.superclass=i,C.prototype=p,i=p.constructor=C}else p={};N.safeMixin(p,l),T=l.constructor,T!==t.constructor&&(T.nom=s,p.constructor=T);for(g=O-1;g;g-=1)T=L[g]._meta,T&&T.chains&&(A=e(A||{},T.chains));p["-chains-"]&&(A=e(A||{},p["-chains-"])),T=!A||!A.hasOwnProperty(s),L[0]=C=A&&A.constructor==="manual"?E(L):L.length===1?w(l.constructor,T):b(L,T),C._meta={bases:L,hidden:l,chains:A,parents:M,ctor:l.constructor},C.superclass=i&&i.prototype,C.extend=y,C.prototype=p,p.constructor=C,p.getInherited=h,p.isInstanceOf=v,p.inherited=d,p.__inherited=c,r&&(p.declaredClass=r,u.setObject(r,C,o));if(A)for(k in A)p[k]&&typeof A[k]=="string"&&k!==s&&(T=p[k]=S(k,L,A[k]==="after"),T.nom=k);return C}var e,t,n,r,i,s,o="ORELang",u={_mixin:function(e,t,n){var r,i,s,o={};for(r in t)if(t.hasOwnProperty(r)){i=t[r];if(!e.hasOwnProperty(r)||e[r]!==i&&(!o.hasOwnProperty(r)||o[r]!==i))e[r]=n?n(i):i}return e},mix:function(){var e,t,n;for(t=0,n=arguments.length;t<n;t+=1)e=u.mixin(e,arguments[t]);return e},mixin:function(e,t){var n,r;arguments.length===1&&(t=e);for(r=1,n=arguments.length;r<n;r+=1)u._mixin(e,arguments[r]);return e},getProp:function(e,t,n){var r,i=0;while(n&&typeof (r=e[i+=1])!="undefined")n=typeof n[r]=="undefined"?n[r]:t?n[r]={}:undefined;return n},setObject:function(e,t,n){n=n||o;var r=e.split("."),i=r.pop(),s=u.getProp(r,!0,n);return s&&i?s[i]=t:undefined},getObject:function(e,t,n){var r,i;return n=n||o,u.isArray(e)?i=e.map(function(e){var r={},i,s;if(u.isObject(e)){for(i in e)e.hasOwnProperty(i)&&(r[i]=u.getProp(e[i].split("."),t,n));s=r}else s=u.getProp(e.split("."),t,n);return s}):(r=e.split("."),i=u.getProp(r,t,n)),i},exists:function(e,t){return u.getObject(e,!1,t)!==undefined}};e=u.mixin,t=Object.prototype,n=t.toString,r=function(){},i=0,s="constructor";var d=p;return u.safeMixin=N.safeMixin=g,u.declare=N,u.declare}),define("circuits/Logger",[],function(){var e=function(e,t,n){var r={TRACE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5},i,s=[];e=r[e.toUpperCase()],t||(t=console),typeof n=="undefined"&&(n=""),i=function(e,r,i,o,u){var a=t[e]||t.info;r=n+r;if(o)i?a.call(t,r+" --> "+JSON.stringify(i)):a.call(t,r);else try{u[0]&&(u[0]=n+u[0]),a.apply(t,u)}catch(f){a(r,i,o,u)}s.forEach(function(t){t.log(e,r,i,o)})},this.addPlugin=function(e){s.push(e)},this.trace=function(t,n,s){e<=r.TRACE&&i("debug",t,n,s,arguments)},this.debug=function(t,n,s){e<=r.DEBUG&&i("debug",t,n,s,arguments)},this.info=function(t,n,s){e<=r.INFO&&i("info",t,n,s,arguments)},this.warn=function(t,n,s){e<=r.WARN&&i("warn",t,n,s,arguments)},this.error=function(t,n,s){e<=r.ERROR&&i("error",t,n,s,arguments)},this.time=function(e){t.time.apply(t,arguments)},this.timeEnd=function(e){t.timeEnd.apply(t,arguments)}};return e}),define("circuits/util",["./declare","./Logger"],function(e,t){var n=new t("debug"),r=e(null,{mixin:function(e,t){for(name in t)e[name]=t[name];return e},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},isUndefined:function(e){return typeof e=="undefined"},fullSchemaName:function(e,t){var r,i=t||"/";return e.indexOf(i)>=0?r=e:e.indexOf("Service")>=0?r="Schema"+i+"services"+i+e:r="Schema"+i+"services"+i+e+"Service",n.debug("Service util created full name ["+r+"] from ["+e+"]"),r},serviceName:function(e,t){var n=t||(e.indexOf(".")!==-1?".":"/"),r=this.fullSchemaName(e,n);return r.substring(r.lastIndexOf(n)+1)},shortName:function(e){return this.serviceName(e).replace("Service","")},executePluginChain:function(e,t){var n,r=null;for(n=1;n<=e.length;n+=1){r=e[e.length-n],t(r);if(r.stopProcessing)break}}});return r}),define("circuits/WebStorage",["./declare"],function(e){var t=e(null,{constructor:function(e){var t=e&&e.namespace||this.declaredClass,n=function(e,n){var r=JSON.parse(n.getItem(t));return r[e]},r=function(e,n,r){var i=JSON.parse(r.getItem(t));i[e]=n,r.setItem(t,JSON.stringify(i))};if(!localStorage)throw new Error("Web storage is not supported by this runtime.");Object.defineProperty(this,"localStorage",{get:function(){return localStorage},set:function(e){throw new Error("The storage attribute is protected.")},enumerable:!0}),Object.defineProperty(this,"sessionStorage",{get:function(){return sessionStorage},set:function(e){throw new Error("The storage attribute is protected.")},enumerable:!0}),this.localStorage.getItem(t)||this.localStorage.setItem(t,"{}"),this.sessionStorage.getItem(t)||this.sessionStorage.setItem(t,"{}"),this.isLocalEmpty=function(){return this.localStorage.getItem(t)==="{}"},this.isSessionEmpty=function(){return this.sessionStorage.getItem(t)==="{}"},this.clearSession=function(){this.sessionStorage.setItem(t,"{}")},this.clearLocal=function(){this.localStorage.setItem(t,"{}")},this.getLocalObject=function(e){return n(e,this.localStorage)},this.setLocalObject=function(e,t){r(e,t,this.localStorage)},this.getSessionObject=function(e){return n(e,this.sessionStorage)},this.setSessionObject=function(e,t){r(e,t,this.sessionStorage)}}});return t}),define("circuits/DataProvider",["./declare"],function(e){var t=e("DataProvider",null,{test:function(e){throw new Error("Must implement DataProvider.test()")},create:function(e){throw new Error("Must implement DataProvider.create()")},read:function(e){throw new Error("Must implement DataProvider.read()")},update:function(e){throw new Error("Must implement DataProvider.update()")},del:function(e){throw new Error("Must implement DataProvider.del()")},httpMethodMap:{GET:{method:"read",hasPayload:!1},POST:{method:"create",hasPayload:!0},PUT:{method:"update",hasPayload:!0},DELETE:{method:"del",hasPayload:!1}}});return t}),define("circuits/Request",["./declare","./util","./Logger"],function(e,t,n){var r=0,i=new t,s=new n("debug"),o=e("Request",null,{constructor:function(e,t){this.params=e,this.fn=t,this.id=r+=1,this.pending=!1,this.complete=!1,this.canceled=!1,this.inError=!1},cancel:function(){s.debug("Canceling request: "+this.id),this.pending=!1,this.canceled=!0},execute:function(){function r(n,r,i){e.xhr=i.xhr,e.statusCode=e.xhr&&e.xhr.status,e.canceled?s.debug("Request ["+e.id+"] was canceled, not calling handler"):(e.pending=!1,e.complete=!0,t(n,r,i))}var e=this,t=this.params.handler,n=i.mixin({},this.params);this.canceled?s.debug("Request ["+e.id+"] was canceled, not executing"):(this.pending=!0,this.fn(i.mixin(n,{handler:r})))}});return o}),define("circuits/OfflineTolerantProvider",["./declare","./util","./WebStorage","./DataProvider","./Request"],function(e,t,n,r,i){var s=new t,o=e("OfflineTolerantProvider",r,{constructor:function(e){var t=new n,r="circuits.retrycache",i=function(e){var n=t.getLocalObject(r);n=n||{},n[e.url]=e,t.setLocalObject(r,n)},o=function(e,n){var i=t.getLocalObject(r);i=i||{},delete i[n.url],t.setLocalObject(r,i)},u=function(){var n=!0,i=t.getLocalObject(r)||{},u=Object.keys(i);return u.length>0&&(n=e.test(i[u[0]])),n&&Object.keys(u).forEach(function(t,n){var r,u=s.mixin({load:function(e,t,n){o(t)},error:function(e,t){}},i[t]),a=e[i[t].methodName];r=a.call(e,i[t]),r.execute()}),n},a=function(t,n){var r=u(),o=s.mixin({},n),a=s.mixin(o,{dontExecute:!0,methodName:t,load:function(e,t){t&&t.xhr&&t.xhr.status===0?t.load.call(t.scope,n.payload,n):t.load.call(t.scope,e,t)},error:function(e,t){i(a),n.load.call(n.scope||this,n.payload||n,n)}}),f=e[t](a);return r?f.execute():i(a),f};this.create=function(t){return e.create(t)},this.read=function(t){return e.read(t)},this.update=function(e){a("update",e)},this.del=function(e){a("del",e)},this.test=function(t){return e.test(t)}}});return o}),define("circuits/DojoXhrDataProvider",["dojo","./declare","./Logger","./DataProvider","./Request"],function(e,t,n,r,i){var s=new n("debug"),o=declare(r,{test:function(e){var t=!0,n;try{n=new XMLHttpRequest,n.open("HEAD",e,!1),n.send()}catch(r){t=!1}return t},create:function(t){var n=e.toJson(t.payload),r=new i({url:t.url,handleAs:t.handleAs||"json",headers:t.headers||{"Content-Type":"application/json"},postData:n,load:t.load||this.defaultLoad,error:t.error||this.defaultError},e.xhrPost);return s.debug("Xhr-based store executing POST to "+t.url,n),t.dontExecute||r.execute(),r},read:function(t){var n=new i({url:t.url,handleAs:t.handleAs||"json",load:t.load||this.defaultLoad,error:t.error||this.defaultError},e.xhrGet);return s.debug("Xhr-based store executing GET to "+t.url),t.dontExecute||n.execute(),n},update:function(t){var n=e.toJson(t.payload),r=new i({url:t.url,handleAs:t.handleAs||"json",headers:t.headers||{"Content-Type":"application/json"},putData:n,load:t.load||this.defaultLoad,error:t.error||this.defaultError},e.xhrPut);return s.debug("Xhr-based store executing PUT to "+t.url,n),t.dontExecute||r.execute(),r},del:function(t){var n=new i({url:t.url,load:t.load||this.defaultLoad,error:t.error||this.defaultError},e.xhrDelete);return s.debug("Xhr-based store executing DELETE to "+t.url),t.dontExecute||n.execute(),n},defaultLoad:function(e,t){s.warn("No load handler specified for XHR call to "+t.url)},defaultError:function(e,t){s.warn("No error handler specified for XHR call to "+t.url),s.error(e)}});return o}),define("circuits/NativeXhrDataProvider",["./declare","./DataProvider","./Request","./Logger"],function(e,t,n,r){var i=new r("debug"),s=e(t,{constructor:function(e){var t=new XMLHttpRequest,n=this;t.upload||i.warn("NativeXhrDataProvider: This runtime is not XHR level 2 compliant."),this.asynchronous=e&&typeof e.asynchronous=="boolean"?e.asynchronous:!0,this.hitchedInvoke=function(){n.invokeXhrSend.apply(n,arguments)}},test:function(e){var t=!0,n;try{n=new XMLHttpRequest,n.open("HEAD",e,!1),n.send()}catch(r){t=!1}return t},create:function(e){var t=e.payload,r,s=e.headers&&e.headers["Content-Type"];return s=s||"application/json",s==="application/json"&&(t=JSON.stringify(e.payload)),r=new n({url:e.url,method:"POST",headers:e.headers||{"Content-Type":s},payload:t,asynchronous:e.asynchronous,responseType:e.responseType||"json",onprogress:e.onprogress||this.defaultOnProgress,handler:e.handler||this.defaultHandler},this.hitchedInvoke),i.debug("Xhr-based store executing POST to "+e.url,t),e.dontExecute||r.execute(),r},read:function(e){var t=new n({url:e.url,method:"GET",asynchronous:e.asynchronous,handler:e.handler||this.defaultHandler,responseType:e.responseType||"json"},this.hitchedInvoke);return i.debug("Xhr-based store executing GET to "+e.url),e.dontExecute||t.execute(),t},update:function(e){var t=e.payload,r,s=e.headers&&e.headers["Content-Type"];return s=s||"application/json",s==="application/json"&&(t=JSON.stringify(e.payload)),r=new n({url:e.url,method:"PUT",asynchronous:e.asynchronous,headers:e.headers||{"Content-Type":s},payload:t,responseType:e.responseType||"json",handler:e.handler||this.defaultHandler},this.hitchedInvoke),i.debug("Xhr-based store executing PUT to "+e.url,t),e.dontExecute||r.execute(),r},del:function(e){var t=new n({url:e.url,asynchronous:e.asynchronous,method:"DELETE",handler:e.handler||this.defaultHandler,responseType:e.responseType||"json"},this.hitchedInvoke);return i.debug("Xhr-based store executing DELETE to "+e.url),e.dontExecute||t.execute(),t},invokeXhrSend:function(e){var t=new XMLHttpRequest,n=typeof e.asynchronous=="boolean"?e.asynchronous:this.asynchronous,r=function(){if(e.onreadystatechange)e.onreadystatechange.call(this);else if(this.readyState===this.DONE&&!this.loadcalled){var t=this.response||this.responseText;this.loadcalled=!0;if(t&&!this.responseType&&e.responseType==="json")try{t=JSON.parse(t)}catch(n){i.debug("Unable to parse JSON: "+t+"\n"+n)}e.handler.call(this,this.status,t,e)}};e.xhr=t,e.timeout&&typeof t.timeout=="number"&&(t.timeout=e.timeout),e.responseType&&typeof t.responseType=="string"&&i.debug("Ignoring responseType on XHR until fully supported."),t.open(e.method,e.url,n),Object.keys(e.headers||{}).forEach(function(n,r,i){(n!=="Content-Type"||e.headers[n]!=="multipart/form-data")&&t.setRequestHeader(n,e.headers[n])}),t.upload&&Object.keys(e).forEach(function(n,r,i){n.indexOf("on")===0&&typeof e[n]=="function"&&(typeof t[n]!="undefined"&&(t[n]=e[n]),typeof t.upload[n]!="undefined"&&(t.upload[n]=e[n]))});if(e.handler||e.onreadystatechange)t.onreadystatechange=r;t.send(e.payload)},defaultHandler:function(e,t){i.debug("No handler specified for XHR call to "+t.url)},defaultProgress:function(e,t){i.debug("No handler specified for XHR call to "+t.url)},defaultOnProgress:function(e){i.warn("No progress handler specified for XHR call to "+e)}});return s}),define("circuits/Plugin",["./declare","./util","./Logger"],function(e,t,n){var r=new n("debug"),i=new t,s=e(null,{constructor:function(e){r.debug("Applying config to new plugin: ",e&&(e.name||e.type)),i.mixin(this,e)}});return s}),define("circuits/plugins/DataProviderPlugin",["../declare","../Plugin"],function(e,t){var n=e(t,{constructor:function(e){this.type="mixin",this.fn=function(e){e.create=e[this.create],e.read=e[this.read],e.update=e[this.update],e.remove=e[this.remove]}}});return n}),define("circuits/plugins/DojoReadApiPlugin",["../util","../Logger","../Plugin","../declare"],function(e,t,n,r){var i=new t("debug"),s=new e,o=r(n,{constructor:function(){this.type="mixin",this.fn=function(e){e.methodName=this.methodName,e.methodArgs=this.methodArgs,e.identityAttributes=this.identityAttributes,e.getValue=function(e,t,n){var r=e[t];return typeof r=="undefined"&&(r=n),r},e.getValues=function(t,n){var r;return e.hasAttribute(t,n)?r=t[n]:r=[],r},e.getAttributes=function(e){return Object.keys(e)},e.hasAttribute=function(e,t){return typeof e[t]!="undefined"},e.containsValue=function(e,t,n){return this.getValue(e,t)===n},e.isItem=function(e){return i.warn("isItem no-op"),!0},e.isItemLoaded=function(e){return i.warn("isItem no-op"),this.isItem(e)},e.loadItem=function(e){i.warn("loadItem no-op")},typeof this.methodName=="function"?e.fetch=this.methodName:e.fetch=function(e){var t=this.methodName,n={};return this.methodArgs.forEach(function(e){n[e]=this[e]},this),e.onComplete&&(e.load=function(t,n,r){return e.onBegin&&e.onBegin(r),e.onComplete(t,n,r)}),s.mixin(e,n),this[t].call(e.scope||this,e,e)},e.getFeatures=function(){return{"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0}},e.getLabel=function(e){return this.isItem(e)?this.getValue(e,"label"):undefined},e.getLabelAttributes=function(e){return["label"]},e.close=function(e){return undefined},e.getIdentity=function(e){return e[this.getIdentityAttributes()]},e.getIdentityAttributes=function(e){var t;return typeof this.identityAttributes=="undefined"?t="id":t=this.identityAttributes,t},e.fetchItemByIdentity=function(e){i.warn("fetchItemByIdentity no-op: "+e)}}}});return o}),define("circuits/plugins/DojoSimpleQueryFilterSortPlugin",["../declare","../Logger","../Plugin","dojo/store/util/SimpleQueryEngine"],function(e,t,n,r){var i=new t("debug"),s=e(n,{constructor:function(){var e=this;this.type="mixin",this.queryEngine=r,this.fn=function(t){t.filterAndSort=function(n,r){var s=t.getMethod(n.methodName),o=s.data;i.info("filter/sort of service data from ["+t.name+"."+n.methodName+"]",n);try{o=e.filter(n.filter,n.sort,o),r.onLoad&&r.onLoad.call(r.scope,o)}catch(u){r.onError?r.onError.call(r.scope):i.error("Plugin: "+e.declaredClass+" got exception "+u+" in service "+t.name)}}}},filter:function(e,t,n){return this.queryEngine(e,{sort:t})(n)}});return s}),define("circuits/plugins/GetValuePlugin",["../declare","../Plugin"],function(e,t){var n=e(t,{constructor:function(){this.type="mixin",this.fn=function(e){e.getValue=function(e,t,n){var r=e[t];return typeof r=="undefined"&&(r=n),r}}}});return n}),define("circuits/plugins/HandlerPlugin",["../declare","../Plugin"],function(e,t){var n=e(t,{constructor:function(){this.type="handler",this.statusPattern="\\.*"}});return n}),define("circuits/plugins/HandlerErrorPlugin",["../declare","./HandlerPlugin"],function(e,t){var n=e(t,{constructor:function(){this.statusPattern="(4|5)\\d\\d"}});return n}),define("circuits/plugins/RetryOnErrorPlugin",["../declare","./HandlerErrorPlugin"],function(e,t){var n=e([t],{constructor:function(e){var t=this,n=0;this.fn=function(e,r){n<t.retry?(n+=1,r.request.execute()):(n=0,t.callback.call(t.scope||t.callback,e,r))}}});return n}),define("circuits/plugins/ServiceCallWrapperPlugin",["../declare","../Plugin"],function(e,t){var n=e(t,{constructor:function(e){this.type="mixin";var t=e.wrapperMethod;this.fn=function(e,n){n.forEach(function(n){var r=e[n];e[n]=function(){var e,n=[];for(e=0;e<arguments.length;e+=1)n.push(arguments[e]);n.push(r),t.apply(this,n)}})}}});return n}),define("circuits/plugins/StringPropertyPrefixPlugin",["../declare","../Plugin"],function(e,t){var n=e(t,{constructor:function(){this.type="read",this.fn=function(e){this.properties.forEach(function(t){var n=e[t],r,i;if(Object.prototype.toString.call(n)==="[object Array]")for(r=0,i=n.length;r<i;r+=1)n[r]=this.prefix+n[r];else e[t]=this.prefix+n},this)}}});return n}),define("circuits/plugins/UrlPrefixPlugin",["../declare","../Plugin"],function(e,t){var n=e(t,{constructor:function(){this.type="url",this.fn=function(e){return this.prefix+e}}});return n}),define("circuits/pluginpack",["./OfflineTolerantProvider","./DojoXhrDataProvider","./NativeXhrDataProvider","./plugins/DataProviderPlugin","./plugins/DojoReadApiPlugin","./plugins/DojoSimpleQueryFilterSortPlugin","./plugins/GetValuePlugin","./plugins/RetryOnErrorPlugin","./plugins/ServiceCallWrapperPlugin","./plugins/StringPropertyPrefixPlugin","./plugins/UrlPrefixPlugin"],function(){}),define("circuits/ServiceDescriptorReader",["./declare"],function(e){var t=e(null,{getSchemaId:function(){throw new Error("Not Implemented")},getRootPath:function(){throw new Error("Not Implemented")},getMethodNames:function(){throw new Error("Not Implemented")},getMethods:function(){throw new Error("Not Implemented")},getMethod:function(e){throw new Error("Not Implemented")},getParameterNames:function(e){throw new Error("Not Implemented")},getParameters:function(e){throw new Error("Not Implemented")},isArgumentRequired:function(e,t){throw new Error("Not Implemented")},getServiceUrl:function(e,t){throw new Error("Not Implemented")},getMethodTransport:function(e){throw new Error("Not Implemented")},getAndValidateArgument:function(e,t){throw new Error("Not Implemented")},replacePathParamsInUrl:function(e,t,n){throw new Error("Not Implemented")},addQueryParamsToUrl:function(e,t,n){throw new Error("Not Implemented")},enumerateParameters:function(e){throw new Error("Not Implemented")},getResponseSchema:function(e){throw new Error("Not Implemented")}});return t}),define("circuits/AmdResolver",["./declare"],function(e){var t=e(null,{constructor:function(e){var t=e&&e.path,n=e&&e.loud,r=e&&e.altSeparator,i=e&&e.synchronous;this.resolver=function(e,s){var o,u=t+e;r&&(u=u.replace(new RegExp(r,"g"),"/"));try{dojo?require({async:!i},[u],function(e){o=e}):require([u],function(e){o=e})}catch(a){if(n)throw a}return o}}});return t}),define("circuits/ZypSMDReader",["./declare","./ServiceDescriptorReader","./Logger","./util","./AmdResolver"],function(e,t,n,r,i){var s=new n("debug"),o=new r,u=e(t,{constructor:function(e,t){function n(e,r,i){Object.keys(e).forEach(function(u,a,f){var l,c=e[u];u==="$ref"?(s.debug("Resolving $ref: "+c),l=t(c),c=typeof l=="function"?new l:l,!o.isUndefined(c)&&(!c.tag||!c.tag.resolved)&&(c.tag||(c.tag={}),c.tag.resolved=!0,n(c,e,u)),r[i]=c):typeof c=="object"&&n(c,e,u)})}function r(e,t){var n=e&&e["extends"],i=[],s=[];return typeof n!="undefined"&&(s=o.isArray(n)?n:[n],s.forEach(function(e){Object.keys(e.properties).forEach(function(t,n,r){var s=e.properties[t];t!=="__parent"&&i.push({parentId:e.id,key:t,value:s})})},this),t.push(i),t=r(n,t)),t}function u(e){function i(t){e.properties[t.key]=t.value}var t,n;t=r(e,[]),e.properties=e.properties||{};while(t.length>0)n=t.pop(),n.forEach(i)}function a(e){e["extends"]&&(a(e["extends"]),e.parameters=e.parameters||[],e.parameters=e.parameters.concat(e["extends"].parameters))}function f(e){s.debug("Resolving sub-properties for "+e.id),a(e),Object.keys(e.services||{}).forEach(function(t,n,r){var i=e.services[t];i.returns=i.returns||e.returns,i.transport=i.transport||e.transport,i.contentType=i.contentType||e.contentType,i.envelope=i.envelope||e.envelope||"URL",i.description=i.description||"",i.returns&&u(i.returns),i.parameters&&i.parameters.forEach(function(e){e.envelope=e.envelope||i.envelope,e.description=e.description||""});var s=i["extends"];if(s){if(!s.id)throw new Error("Parent schema for method ["+t+"] in schema "+e.id+" is invalid.");i.parameters?i.parameters=i.parameters.concat(s.parameters):i.parameters=s.parameters}}),e.tag||(e.tag={}),e.tag.resolved=!0}s.debug("Creating reader for schema",e),t||(t=(new i({path:"",altSeparator:"\\.",synchronous:!0})).resolver),this.smd=e;if(!e.tag||!e.tag.resolved)n(e,null,null),s.debug("Resolved schema $refs",e),f(e);var l={};l.parameters={},this.getMethodNames().forEach(function(e){var t=this.smd.services[e];t.parameters&&t.parameters.forEach(function(t){l[e+"-"+t.name]=t})},this),this.findParameter=function(e,t){return l[e+"-"+t]}},getSchemaId:function(){return this.smd.id},getRootPath:function(){return this.smd.target},getMethodNames:function(){var e=[];return Object.keys(this.smd.services||{}).forEach(function(t,n,r){e.push(t)}),e},getMethods:function(){var e=[],t=this.smd.services;return Object.keys(t||[]).forEach(function(n,r,i){e.push(t[n])}),e},getMethod:function(e){var t=this.smd.services[e];if(!t)throw new Error("no such method");return t},getParameterNames:function(e){var t=[],n=this.getParameters(e);return n.forEach(function(e){t.push(e.name)}),t},getParameters:function(e){var t=this.smd.parameters||[];return t=t.concat(this.smd.services[e].parameters||[]),t},isArgumentRequired:function(e,t){var n=this.findParameter(e,t).required;return n?!0:!1},getServiceUrl:function(e,t){var n=this.smd.services[e],r=this.getRootPath(),i,s=this.enumerateParameters(n);return i=r+(n.target?"/"+n.target:""),i=this.replacePathParamsInUrl(i,s.PATH,t),i=this.addQueryParamsToUrl(i,s.URL,t),i},getMethodTransport:function(e){return this.smd.services[e].transport},getAndValidateArgument:function(e,t){t=t||{};var n=t[e.name];if(typeof n=="undefined"&&e.required===!0)throw new Error("Missing required param for service call: "+e.name);return n},replacePathParamsInUrl:function(e,t,n){var r,i,s,o;for(r=0,i=t.length;r<i;r+=1)s=t[r],o=this.getAndValidateArgument(s,n),typeof o!="undefined"&&(e=e.replace("{"+s.name+"}",encodeURIComponent(o)));return e},addQueryParamsToUrl:function(e,t,n){var r,i,s="",o,u,a,f=!0;for(r=0,i=t.length;r<i;r+=1)o=t[r],u=this.getAndValidateArgument(o,n),typeof u!="undefined"&&(a=o.name+"="+encodeURIComponent(u),f?(f=!1,s+="?"+a):s+="&"+a);return e+=s,e},enumerateParameters:function(e){var t,n,r=this.smd.parameters,i,s=e.parameters||[],o={PATH:[],URL:[],JSON:[],ENTITY:[]};r=r?r.concat(s):s;if(r)for(t=0,n=r.length;t<n;t+=1)i=r[t],o[i.envelope].push(i);return o},getResponseSchema:function(e){return this.smd.services[e].returns},getRequestPayloadParam:function(e){var t=this.getParameters(e),n;return t.forEach(function(e){e&&(e.envelope==="JSON"||e.envelope==="ENTITY")&&(n=e)}),n},getRequestSchema:function(e){var t=this.getRequestPayloadParam(e),n=t&&t.type;return n},getResponsePayloadName:function(e){var t=this.smd,n=t.services[e],r=n&&n.payload||t.payload;return r},getRequestPayloadName:function(e){var t=this.getRequestPayloadParam(e),n=t&&t.payload;return n},isListResponse:function(e){var t=this.getResponseSchema(e),n=this.getResponsePayloadName(e),r=!1;return t.type!=="null"&&(n&&t.properties[n]&&t.properties[n].type==="array"||t.type&&t.type==="array")&&(r=!0),r}});return u}),define("circuits/ServiceMethod",["./Logger","./util","./declare"],function(e,t,n){var r=new t,i=new e("debug"),s=n(null,{constructor:function(e,t,n){this.name=e,this.reader=t,this.provider=n,this.responsePayloadName=t.getResponsePayloadName(this.name),this.requestPayloadName=t.getRequestPayloadName(this.name),this.transport=t.getMethodTransport(this.name),this.smdMethod=t.getMethod(this.name)},invoke:function(e,t){i.debug("Calling service method: "+this.name+" with params",e);var n=this,s=this.provider,o=this.transport,u=this.reader.getServiceUrl(this.name,e),a=this.reader.getResponseSchema(this.name),f=this.reader.getRequestPayloadParam(this.name),l,c=e.payload||e,h=r.mixin({},e),p=a.type==="any"?"blob":"json",d=function(e,i,s){var o=e.toString(),u=e<400?n.processResponse(e,i,t,s):i,a=0;h.request.total=i&&i.total,h.links=i&&i.links,a=i&&i.total,r.executePluginChain(t.handler,function(e){var t=new RegExp(e.statusPattern);h.plugin=e,t.test(o)&&e.fn.call(e.scope||e,u,h,a)})},v=function(e){r.executePluginChain(t.progress,function(t){t.fn.call(t.scope||t,e.lengthComputable,e.loaded,e.total)})};return r.executePluginChain(t.url,function(e){u=e.fn.call(e.scope||e,u,n)}),t.provider&&t.provider.length>0&&(s=t.provider[t.provider.length-1],s=s.fn.call(s.scope||s,this)),s.httpMethodMap[o].hasPayload&&(f&&f.enctype?l={"Content-Type":f.enctype}:c=this.processRequest(c,t)),i.debug("Calling method ["+this.name+"] with URL: "+u),h.request=s[s.httpMethodMap[o].method]({url:u,headers:l,payload:c,handler:d,onprogress:v,asynchronous:e.asynchronous,dontExecute:!0}),a.type==="any"?(h.request.url=u,h.request.mediaType=this.smdMethod.contentType||"",i.debug("Setting request for returnType=any  "+h.request)):h.request.execute(),h.request},processRequest:function(e,t,n){var i=e||"",s,o=this;return this.requestPayloadName&&!e[this.requestPayloadName]&&(e={},e[this.requestPayloadName]=i),r.executePluginChain(t.request,function(t){s=t.fn.call(t.scope||t,e,o,n),e=s||e}),i=this.requestPayloadName&&e[this.requestPayloadName]||e,r.executePluginChain(t.write,function(e){r.isArray(i)?i.forEach(function(t,n){s=e.fn.call(e.scope||e,t,o),i[n]=s||i[n]},o):(s=e.fn.call(e.scope||e,i,o),i=s||i)}),this.requestPayloadName?e[this.requestPayloadName]=i:e=i,e},processResponse:function(e,t,n,s){var o=this.reader.isListResponse(this.name),u=this.reader.getResponseSchema(this.name).type||"any",a,f,l=this,c,h="(2|3)\\d\\d";return u&&u!=="null"&&(typeof t=="object"&&r.executePluginChain(n.response,function(n){var r=n.statusPattern||h,i=new RegExp(r);i.test(e)&&(c=n.fn.call(n.scope||n,t,l,s),t=c||t)}),a=t,this.responsePayloadName!==null&&t[this.responsePayloadName]&&(a=t[this.responsePayloadName],i.debug("Extracting payload for ["+this.name+"] from ["+this.payloadName+"] property",a)),r.executePluginChain(n.read,function(t){var n=t.statusPattern||h,r=new RegExp(n);r.test(e)&&(o?a.some(function(e,n){c=t.fn.call(t.scope||t,e,l),a[n]=c||a[n]},l):(c=t.fn.call(t.scope||t,a,l),a=c||a))})),this.data=a,a}});return s}),define("circuits/PluginMatcher",["./declare","./util","./Logger"],function(e,t,n){var r=new t,i=new n("info"),s=e(null,{constructor:function(){this.defaults={read:[],write:[],url:[],request:[],response:[],mixin:[],provider:[],progress:[],handler:[]}},match:function(e,t){var n,r;return r=t&&(t.pointcut||t.pattern)||t,t&&t.pointcut||typeof t=="string"?n=this.matchPointcut:n=this.matchPattern,n(e,r)},matchPointcut:function(e,t){var n,r,s,o;return t=t||"*.*",n=t.replace(/\./g,"\\.").replace(/\*/g,".*"),i.debug("pointcut is: "+t),t.indexOf("*")!==0&&(n="\\b"+n),t.lastIndexOf("*")!==t.length-1&&(n+="\\b"),i.debug("regexString is: "+n),r=new RegExp(n),i.debug("PluginMatcher match testing ["+e+"] against regex ["+n+"]"),s=r.exec(e),s!==null},matchPattern:function(e,t){var n,r;return t=t||".*",n=new RegExp(t),i.debug("PluginMatcher matchPattern testing ["+e+"] against regex ["+t+"]"),r=n.exec(e),r!==null},list:function(e,t,n,r){var s=e+"."+t,o=[];return r&&r.length>0&&r.forEach(function(e){var t=this.match(s,e);i.debug("match for "+e.name+": "+t),t&&e.type===n?(i.debug("adding "+e.name+" to list"),o.push(e)):i.debug("not adding "+e.name+" to list")},this),o},listForServiceOnly:function(e,t,n,r){var s=[];return r&&r.length>0&&r.forEach(function(r){var o=this.matchingMethodNames(e,t,r);o.length&&r.type===n?(i.debug("adding "+r.name+" to service only list"),s.push(r)):i.debug("not adding "+r.name+" to service only list")},this),s},matchingMethodNames:function(e,t,n){var r,i=[];return t.forEach(function(t){r=e+"."+t;var s=this.match(r,n);s&&i.push(t)},this),i},getPhaseChains:function(e,t,n,i,s){var o=r.mixin({},this.defaults),u=this;return Object.keys(o).forEach(function(r,a,f){var l=u.list(e,t,r,n),c=u.list(e,t,r,i),h=u.list(e,t,r,s);o[r]=[].concat(l||[],c||[],h||[])}),o}});return s}),define("circuits/plugins/HandlerSuccessPlugin",["../declare","./HandlerPlugin"],function(e,t){var n=e(t,{constructor:function(){this.statusPattern="(2|3)\\d\\d"}});return n}),define("circuits/Service",["./declare","./ServiceMethod","./PluginMatcher","./util","./Logger","./plugins/HandlerErrorPlugin","./plugins/HandlerSuccessPlugin"],function(e,t,n,r,i,s,o){var u=new r,a=new i("debug"),f=e(null,{constructor:function(e,r,i,f){var l=this,c={},h=[],p=e.getSchemaId();a.debug("Creating new Service based on schema: "+p),a.debug("Got service plugins",f),a.debug("Got factory plugins",i),this.reader=e,this.name=u.serviceName(p),this.factoryPlugins=i,this.plugins=f,this.pluginMatcher=new n,e.getMethodNames().forEach(function(n){var i=new t(n,e,r);c[n]=i,h.push(i),this[n]=function(e,t){var r=l.convertCallbackParam(t),s=l.resolvePlugins(n,r);return i.invoke(e,s)}},this),this.getMethod=function(e){return c[e]},this.convertCallbackParam=function(e){var t=e||[],n,r;return e&&Object.prototype.toString.call(e)!=="[object Array]"&&(t=[],e.load&&(a.debug("Generating handler plugin on load (load)"),r={name:"generatedHandlerSuccess",fn:e.load},r.scope=e.scope||r,t.push(new o(r))),e.error&&(a.debug("Generating handler plugin on error (error)"),r={name:"generatedHandlerError",fn:e.error},r.scope=e.scope||r,t.push(new s(r))),e.onLoad&&(a.debug("Generating handler plugin on load (onLoad)"),r={name:"generatedHandlerSuccess",fn:e.onLoad},r.scope=e.scope||r,t.push(new o(r))),e.success&&(a.debug("Generating handler plugin for load (success)"),r={name:"generatedHandlerSuccess",fn:e.success},r.scope=e.scope||r,t.push(new o(r))),e.onError&&(a.debug("Generating handler plugin on error (onError)"),r={name:"generatedHandlerError",fn:e.onError},r.scope=e.scope||r,t.push(new s(r))),e.onProgress&&(a.debug("Generating plugin on load (onLoad)"),r={name:"generatedOnProgress",fn:e.onProgress,type:"progress"},r.scope=e.scope||r,t.push(r)),e.progress&&(a.debug("Generating plugin on error (onError)"),r={name:"generatedOnProgress",fn:e.progress,type:"progress"},r.scope=e.scope||r,t.push(r))),t},this.getMethods=function(){return h},a.debug("Service initialized",this)},addPlugin:function(e){this.plugins.push(e),a.debug(e.name+" has been added")},removePlugin:function(e){var t,n,r=this.plugins;a.debug("Attempting to remove "+e.name);for(t=0;t<r.length;t+=1){n=r[t];if(n.name===e.name&&n.type===e.type){r.splice(t,1),a.debug(e.name+" has been removed");break}}},resolvePlugins:function(e,t){a.debug("Resolving plugins for "+this.name+" "+e);var n=this.pluginMatcher.getPhaseChains(this.name,e,this.factoryPlugins,this.plugins,t);return n}});return f}),define("circuits/ServiceQueue",["./Logger","./util","./declare"],function(e,t,n){var r=new e("debug"),i=new t,s=n(null,{constructor:function(e){var t=[],n=!1,r=[];this.autoRefreshInterval=e.autoRefreshInterval||0,this.clear=function(){t=[],r=[],n=!1,this.lastTimer&&clearTimeout(this.lastTimer)},this.reset=function(){var e=t;this.clear(),t=e},this.hasBeenExecuted=function(){return this.executed},this.executionComplete=function(){return t.length===r.length},this.add=function(e,n,r){t.push({fn:e,params:n,callbacks:r})},this.hasErrors=function(){var e=!1;return r.forEach(function(t,n){t.inError&&(e=!0)},this),e},this.getCompletedRequests=function(){var e=[].concat(r);return e},this.isEmpty=function(){return t.length===0},this.execute=function(e,n){var s=this;if(this.hasBeenExecuted()){if(!this.executionComplete())throw new Error("Attempt to re-execute an in-progress queue.");this.reset()}this.executed=!0,t.forEach(function(o,u){var a=i.mixin({},o.callbacks),f=a.load;a.load=function(i,u,a){r.push(u.request),f.call(o.callbacks.scope,i,u,a),t.length===r.length&&(n?e.call(n,s):e(s),s.autoRefreshInterval&&(s.lastTimer=setTimeout(function(){s.execute(e,n)},s.autoRefreshInterval)))},o.fn.call(a.scope,o.params,a)},this),this.isEmpty()&&(n?e.call(n,s):e(s))}}});return s}),define("circuits/ServiceFactory",["./declare","./ZypSMDReader","./Service","./PluginMatcher","./util","./Logger","./ServiceQueue","./NativeXhrDataProvider"],function(e,t,n,r,i,s,o,u){var a=new i,f=new s("debug"),l=e(null,{pluginMatcher:new r,constructor:function(e){this.config=a.mixin({plugins:[],provider:new u({}),resolver:function(e){var t;return require({async:!1},[e],function(e){t=e}),t},resolverByModel:function(e){var t;return require({async:!1},[e+"Service"],function(e){t=e}),t}},e)},getServiceForModel:function(e,t){f.debug("Getting service for model: "+e);var n=this.config.resolverByModel(e);return this.getService(n,t)},getServiceByName:function(e,t){f.debug("Getting service: "+e);var n=this.config.resolver(e);return this.getService(n,t)},getServiceQueue:function(e){return new o(e||{})},getService:function(e,t){var r=this.newReader(e),i=this.config.provider,s=this.pluginMatcher,o=t||[],u=[],l,c;return u=u.concat(this.pluginMatcher.listForServiceOnly(a.serviceName(r.getSchemaId()),r.getMethodNames(),"mixin",this.config.plugins),this.pluginMatcher.listForServiceOnly(a.serviceName(r.getSchemaId()),r.getMethodNames(),"mixin",o)),c=new n(r,i,this.config.plugins,o),f.debug("Mixin plugins for "+c.name,u),a.executePluginChain(u,function(e){l=s.matchingMethodNames(c.name,r.getMethodNames(),e),e.fn.call(e.scope||e,c,l)}),c},addPlugin:function(e){this.config.plugins.push(e),f.debug("Plugin: "+e.name+" has been added")},removePlugin:function(e){this.removePluginByName(e.name,e.type),f.debug("Plugin: "+e.name+" has been removed")},removePluginByName:function(e,t){f.debug("Attempting to remove plugin: "+e);var n,r,i=this.config.plugins;for(n=0;n<i.length;n+=1){r=i[n];if(r.name===e&&r.type===t){i.splice(n,1),f.debug("Plugin: "+e+" has been removed");break}}},newReader:function(e){var n=new t(e,this.config.resolver);if(!e.SMDVersion)throw new Error("Argument is not an SMD.");return n}});return l}),define("circuits/allpack",["./pluginpack","./ServiceFactory"],function(){});